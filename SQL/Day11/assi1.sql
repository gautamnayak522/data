--BRANCH table

CREATE TABLE BRANCH
(
	BNAME VARCHAR(18) PRIMARY KEY,
	CITY VARCHAR(18) NOT NULL
)

INSERT INTO BRANCH VALUES ('VRCE','NAGPUR'),('AJNI','NAGPUR'),('KAROLBAGH','DELHI'),
('CHANDNI','DELHI'),('DHARAMPETH','NAGPUR'),('M.G.ROAD','BANGLORE'),('ANDHERI','MUMBAI'),
('VIRAR','MUMBAI'),('NEHRU PLACE','DELHI'),('POWAI','MUMBAI')

--Customer Table

CREATE TABLE CUSTOMER
(
	CNAME VARCHAR(19) PRIMARY KEY,
	CITY VARCHAR(19) NOT NULL
)

INSERT INTO CUSTOMER VALUES ('ANIL','KOLKATA'),('SUNIL','DELHI'),
('MEHUL','BARODA'),('MANDAR','PATNA'),('MADHURI','NAGPUR'),('PRAMOD','NAGPUR'),
('SANDIP','SURAT'),('SHIVANI','MUMBAI'),('KRANTI','MUMBAI'),('NAREN','MUMBAI')

CREATE TABLE DEPOSIT
(
	ACTNO VARCHAR(5) PRIMARY KEY,
	CNAME VARCHAR(19),
	BNAME VARCHAR(18),
	AMOUNT INT,
	ADATE DATE,
	CONSTRAINT FK_CNAME FOREIGN KEY (CNAME) REFERENCES CUSTOMER(CNAME),
	CONSTRAINT FK_BNAME FOREIGN KEY (BNAME) REFERENCES BRANCH(BNAME)
)
INSERT INTO DEPOSIT VALUES ('100','ANIL','VRCE',1000,'1-Mar-1995')
INSERT INTO DEPOSIT VALUES ('101','SUNIL','AJNI',5000,'4-Jan-1996')
INSERT INTO DEPOSIT VALUES ('102','MEHUL','KAROLBAGH',3500,'17-Nov-1995')
INSERT INTO DEPOSIT VALUES ('104','MADHURI','CHANDNI',1200,'17-Dec-1995')
INSERT INTO DEPOSIT VALUES ('105','PRAMOD','M.G.ROAD',3000,'17-Dec-1995')
INSERT INTO DEPOSIT VALUES ('106','SANDIP','ANDHERI',2000,'27-Mar-1996')
INSERT INTO DEPOSIT VALUES ('107','SHIVANI','VIRAR',1000,'31-Mar-1996')
INSERT INTO DEPOSIT VALUES ('108','KRANTI','NEHRU PLACE',1000,'5-Sep-1995')
INSERT INTO DEPOSIT VALUES ('109','NAREN','POWAI',1000,'2-Jul-1995')


CREATE TABLE BORROW
(
	LOANNO VARCHAR(5) PRIMARY KEY,
	CNAME VARCHAR(19),
	BNAME VARCHAR(18),
	AMOUNT INT,
	CONSTRAINT FK_CNAME_B FOREIGN KEY(CNAME) REFERENCES CUSTOMER(CNAME),
	CONSTRAINT FK_BNAME_B FOREIGN KEY(BNAME) REFERENCES BRANCH(BNAME)
)

INSERT INTO BORROW VALUES ('201','ANIL','VRCE',1000)
INSERT INTO BORROW VALUES ('206','MEHUL','AJNI',5000)
INSERT INTO BORROW VALUES ('311','SUNIL','DHARAMPETH',3000)
INSERT INTO BORROW VALUES ('321','MADHURI','ANDHERI',2000)
INSERT INTO BORROW VALUES ('375','PRAMOD','VIRAR',8000)
INSERT INTO BORROW VALUES ('481','KRANTI','NEHRU PLACE',3000)


-----------------------------

SELECT * FROM BRANCH
SELECT * FROM CUSTOMER
SELECT * FROM DEPOSIT
SELECT * FROM BORROW

-------------------------------------
--#1
--Create a Store Procedure which will accept name of the customer as input parameter and product the following output, 
--List Names of Customers who are Depositors and have Same Branch City as that of input parameter customer’s Name.

CREATE PROCEDURE SP_CUSTOMER_OP @cname VARCHAR(50)
AS
BEGIN
	SET NOCOUNT ON
	DECLARE @CITY VARCHAR(50)
	SET @CITY = (SELECT CITY FROM CUSTOMER WHERE CNAME=@cname)
	PRINT @CITY

	SELECT D.CNAME 
	FROM DEPOSIT D JOIN BRANCH B
	ON D.BNAME=B.BNAME
	WHERE B.CITY=@CITY
END

EXECUTE SP_CUSTOMER_OP 'PRAMOD'

DROP PROCEDURE SP_CUSTOMER_OP


--#2 Create a Store Procedure that will accept city name and returns the number of customers in that city.


CREATE PROCEDURE COUNT_CUSTOMER_IN_CITY @CITY VARCHAR(50)
AS
BEGIN
	SET NOCOUNT ON
	SELECT COUNT(CNAME) AS 'NO. OF CUSTOMERS'  FROM CUSTOMER WHERE CITY=@CITY
	RETURN (SELECT COUNT(CNAME) AS 'NO. OF CUSTOMERS'  FROM CUSTOMER WHERE CITY=@CITY)
END



DECLARE @return int
EXECUTE @return = COUNT_CUSTOMER_IN_CITY 'MUMBAI'
PRINT 'NO OF CUSTOMERS ARE : ' + CAST(@return AS VARCHAR)

EXECUTE COUNT_CUSTOMER_IN_CITY 'BARODA'



--#3 Count the Number of Customers Living in the City where Branch is Located

SELECT * FROM CUSTOMER
SELECT * FROM BRANCH

SELECT COUNT(CNAME) AS 'COUNT OF CUSTOMER IN CITY' FROM CUSTOMER WHERE CITY IN (SELECT DISTINCT CITY FROM BRANCH)


